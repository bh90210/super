// protoc --go_out=. --go_opt=paths=source_relative \
//  --go-grpc_out=. --go-grpc_opt=paths=source_relative \
//  api/api.proto
syntax = "proto3";

option go_package = "github.com/bh90210/super/api";

package api;

service Library {
  rpc Get(LibraryRequest) returns (stream LibraryResponse) {}
  rpc Download(DownloadRequest) returns (stream DownloadResponse) {}
}

message LibraryRequest { fixed64 index = 1; }

message LibraryResponse {
  fixed64 index = 1;
  repeated File add_index = 2;
  repeated File remove_index = 3;
}

message File {
  string artist = 1;
  string album = 2;
  string track = 3;
  string duration = 4;
  string path = 5;
}

message DownloadRequest { string path = 1; }

message DownloadResponse { bytes data = 1; }

service Dupload {
  rpc Upload(stream UploadRequest) returns (stream UploadResponse) {}
}

message UploadRequest {
  oneof request {
    string path = 1;
    bytes data = 2;
  }
}

message UploadStatus {
  enum Status {
    INVALID_PATH = 0;
    FILE_EXISTS = 1;
    UPLOADING = 2;
    CANCELLED = 3;
  }

  Status status = 4;
}

message UploadResponse {
  oneof response {
    UploadStatus status = 1;
    int64 progress = 2;
  }
}